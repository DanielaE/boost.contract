#!/bin/bash

# $Id$ #

# Usage: cxx-ignore_duplicate_friend_warning CXX_COMPILER [CXX_COMPILER_OPTION]
# If "-Werror" is found in compiler command's options, then output is filtered
# to error on any warning *but* the "duplicate friend" warning.
# Example:
#   cxx-ignore_duplicate_friend_warning g++ -Wall -Werror ... # Error on warn.
#   cxx-ignore_duplicate_friend_warning g++ -Wall ... # Does not error.

werror=0 # If "-Werror" was specified.
cmd_without_werror="" # Compiler command with eventual "-Werror" stipped out.
for arg in ${*}; do
    if [ "$arg" == "-Werror" ]; then
        werror=1
    else
        cmd_without_werror="$cmd_without_werror $arg"
    fi
done

if [ $werror -eq 0 ]; then
    $cmd_without_werror
else
    # All warnings (but duplicate friend) as errors.
    $cmd_without_werror 2>&1 | perl bin/cxx-duplicate_friend_warning_filter.pl
fi

