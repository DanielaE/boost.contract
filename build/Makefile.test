# $Id$ #

def:=-DDBC_ALL -DDBC_CONFIG_LOG_LEVEL=DBC_LOG_LEVEL_ALL

inc:=-I./include
src:=./test
build:=./build/test
bin:=./bin
codedoc:=./codedoc/test

all: Access Const Construction Subcontracting Operators Checking doc

clean:
	rm -rf $(build)

force_:

Access: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Access/access.cpp -o $(build)/access

Const: const_body const_precond_postcond_inv_ok const_precond_err const_postcond_err const_inv_err
const_body: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Const/body-ok.cpp $(src)/Const/body-main.cpp -o $(build)/body-ok
	$(bin)/must-fail g++ -Wall $(inc) $(def) $(src)/Const/body-err_assign_var.cpp $(src)/Const/body-main.cpp -o $(build)/body-err_assign_var
	$(bin)/must-fail g++ -Wall $(inc) $(def) $(src)/Const/body-err_call_nonconst_fun.cpp $(src)/Const/body-main.cpp -o $(build)/body-err_call_nonconst_fun
const_precond_postcond_inv_ok: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Const/precond_postcond_inv-ok.cpp -o $(build)/precond_postcond_inv-ok
const_precond_err: force_
	mkdir -p $(build)
	$(bin)/must-fail g++ -Wall $(inc) $(def) $(src)/Const/precond-err_assign_self_var.cpp -o $(build)/precond-err_assign_sef_var
	$(bin)/must-fail g++ -Wall $(inc) $(def) $(src)/Const/precond-err_call_self_nonconst_fun.cpp -o $(build)/precond-err_call_self_nonconst_fun
	$(bin)/must-fail g++ -Wall $(inc) $(def) $(src)/Const/precond-err_assign_arg.cpp -o $(build)/precond-err_assign_arg
const_postcond_err: force_
	mkdir -p $(build)
	$(bin)/must-fail g++ -Wall $(inc) $(def) $(src)/Const/postcond-err_assign_self_now_var.cpp -o $(build)/postcond-err_assign_sef_now_var
	$(bin)/must-fail g++ -Wall $(inc) $(def) $(src)/Const/postcond-err_assign_self_old_var.cpp -o $(build)/postcond-err_assign_sef_old_var
	$(bin)/must-fail g++ -Wall $(inc) $(def) $(src)/Const/postcond-err_call_self_now_nonconst_fun.cpp -o $(build)/postcond-err_call_self_now_nonconst_fun
	$(bin)/must-fail g++ -Wall $(inc) $(def) $(src)/Const/postcond-err_call_self_old_nonconst_fun.cpp -o $(build)/postcond-err_call_self_old_nonconst_fun
	$(bin)/must-fail g++ -Wall $(inc) $(def) $(src)/Const/postcond-err_assign_arg_now.cpp -o $(build)/postcond-err_assign_arg_now
	$(bin)/must-fail g++ -Wall $(inc) $(def) $(src)/Const/postcond-err_assign_arg_old.cpp -o $(build)/postcond-err_assign_arg_old
const_inv_err: force_
	mkdir -p $(build)
	$(bin)/must-fail g++ -Wall $(inc) $(def) $(src)/Const/inv-err_assign_self_var.cpp -o $(build)/inv-err_assign_sef_var
	$(bin)/must-fail g++ -Wall $(inc) $(def) $(src)/Const/inv-err_call_self_nonconst_fun.cpp -o $(build)/inv-err_call_self_nonconst_fun

Construction: construction_ok construction_precond_err throwing_constructor throwing_constructor_init throwing_destructor throwing_mem_fun
construction_ok: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Construction/construction.cpp -o $(build)/construction
construction_precond_err: force_
	mkdir -p $(build)
	$(bin)/must-fail g++ -Wall $(inc) $(def) $(src)/Construction/construction-err_precond_access_self.cpp -o $(build)/construction-err
throwing_constructor: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Construction/throwing_constructor.cpp -o $(build)/throwing_constructor
throwing_constructor_init: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Construction/throwing_constructor_init.cpp -o $(build)/throwing_constructor_init
throwing_destructor: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Construction/throwing_destructor.cpp -o $(build)/throwing_destructor
throwing_mem_fun: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Construction/throwing_mem_fun.cpp -o $(build)/throwing_mem_fun

Subcontracting: base_class base_template class_subcontracts_template template_subcontracts_template deep_subcontracting
base_class: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Subcontracting/base_class.cpp -o $(build)/base_class
class_subcontracts_class: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Subcontracting/class_subcontracts_class.cpp -o $(build)/class_subcontracts_class
template_subcontracts_class: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Subcontracting/template_subcontracts_class.cpp -o $(build)/template_subcontracts_class
base_template: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Subcontracting/base_template.cpp -o $(build)/base_template
class_subcontracts_template: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Subcontracting/class_subcontracts_template.cpp -o $(build)/class_subcontracts_template
template_subcontracts_template: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Subcontracting/template_subcontracts_template.cpp -o $(build)/template_subcontracts_template
deep_subcontracting: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Subcontracting/deep_subcontracting.cpp -o $(build)/deep_subcontracting

Operators: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Operators/operators.cpp -o $(build)/operators

Checking: force_
	mkdir -p $(build)
	# Compile this test with different DBC_CHECKING... levels.
	# Verbose log DBC_CONFIG_LOG_LEVEL set by program code itself.
	g++ -Wall $(inc) -DDBC_NO $(src)/Checking/checking.cpp -o $(build)/checking-no
	g++ -Wall $(inc) -DDBC_ALL $(src)/Checking/checking.cpp -o $(build)/checking-all
	# Only one at the time
	g++ -Wall $(inc) -DDBC_CHECK_REQUIRE $(src)/Checking/checking.cpp -o $(build)/checking-require_only
	g++ -Wall $(inc) -DDBC_CHECK_ENSURE $(src)/Checking/checking.cpp -o $(build)/checking-ensure_only
	g++ -Wall $(inc) -DDBC_CHECK_INVARIANT $(src)/Checking/checking.cpp -o $(build)/checking-invariant_only
	# Eiffel like combinations.
	g++ -Wall $(inc) -DDBC_CHECK_REQUIRE $(src)/Checking/checking.cpp -o $(build)/checking-require
	g++ -Wall $(inc) -DDBC_CHECK_REQUIRE -DDBC_CHECK_ENSURE $(src)/Checking/checking.cpp -o $(build)/checking-require_and_ensure
	g++ -Wall $(inc) -DDBC_CHECK_REQUIRE -DDBC_CHECK_ENSURE -DDBC_CHECK_INVARIANT $(src)/Checking/checking.cpp -o $(build)/checking-require_ensure_and_invariant
	# Code documentation.
	g++ -Wall $(inc) -DDBC_DOC $(src)/Checking/checking.cpp -o $(build)/checking-doc
	# Invalid combinations -- compilation must fail.
	$(bin)/must-fail g++ -Wall $(inc) -DDBC $(src)/Checking/checking.cpp -o $(build)/checking-dbc
	$(bin)/must-fail g++ -Wall $(inc) -DDBC_NO -DDBC_ALL $(src)/Checking/checking.cpp -o $(build)/checking-no_and_all
	$(bin)/must-fail g++ -Wall $(inc) -DDBC_DOC -DDBC_ALL $(src)/Checking/checking.cpp -o $(build)/checking-doc_and_all

Copyable: copyable copyable_ptr
copyable: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Copyable/copyable.cpp -o $(build)/copyable
copyable_ptr: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Copyable/copyable_ptr.cpp -o $(build)/copyable_ptr

doc: force_
	mkdir -p $(build)
	g++ -Wall $(inc) $(def) $(src)/Doc/doc.cpp -o $(build)/doc
	mkdir -p $(codedoc)
	doxygen codedoc/Doxyfile.test

