<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Contract++ 0.3.469</title>
<link rel="stylesheet" href="doc/html/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.73.2">
<link rel="start" href="index.html" title="Contract++ 0.3.469">
<link rel="next" href="contract__/getting_started.html" title="Getting Started">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="spirit-nav"><a accesskey="n" href="contract__/getting_started.html"><img src="./doc/html/images/next.png" alt="Next"></a></div>
<hr>
<div class="preface" lang="en">
<div class="titlepage"><div>
<div><h2 class="title">
<a name="contractpp"></a>Contract++ 0.3.469</h2></div>
<div><div class="authorgroup"><div class="author"><h3 class="author">
<span class="firstname">Lorenzo</span> <span class="surname">Caminiti</span>
</h3></div></div></div>
<div><p class="copyright">Copyright © 2009 -2010 Lorenzo Caminiti</p></div>
<div><div class="legalnotice">
<a name="id2593680"></a><p>
        Distributed under the Contract++ Software License, Version 1.0 (see accompanying
        file LICENSE_1_0.txt)
      </p>
</div></div>
</div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="section"><a href="index.html#contract__.introduction">Introduction</a></span></dt>
<dt><span class="section"><a href="contract__/getting_started.html">Getting Started</a></span></dt>
<dt><span class="section"><a href="contract__/tutorial.html">Tutorial</a></span></dt>
<dt><span class="section"><a href="contract__/without_the_macros.html">Without the Macros</a></span></dt>
<dt><span class="section"><a href="contract__/throw_on_failure.html"> Annex: Throw on Failure</a></span></dt>
<dt><span class="section"><a href="contract__/contract_programming.html"> Annex: Contract Programming</a></span></dt>
<dt><span class="section"><a href="contract__/examples.html">Examples</a></span></dt>
<dt><span class="section"><a href="reference.html">Reference</a></span></dt>
<dt><span class="section"><a href="contract__/bibliography.html">Bibliography</a></span></dt>
<dt><span class="section"><a href="contract__/license.html">License</a></span></dt>
<dt><span class="section"><a href="contract__/release_history.html">Release History</a></span></dt>
<dt><span class="section"><a href="contract__/todo.html">TODO</a></span></dt>
</dl>
</div>
<p>
    The Contract++ library implements Contract Programming for the C++ programming
    language.
  </p>
<div class="informaltable"><table class="table">
<colgroup>
<col>
<col>
</colgroup>
<thead><tr>
<th>
          <p>
            What
          </p>
          </th>
<th>
          <p>
            Where
          </p>
          </th>
</tr></thead>
<tbody>
<tr>
<td>
          <p>
            Download
          </p>
          </td>
<td>
          <p>
            <a href="http://sourceforge.net/projects/dbcpp/" target="_top">http://sourceforge.net/projects/dbcpp/</a>
          </p>
          </td>
</tr>
<tr>
<td>
          <p>
            Help
          </p>
          </td>
<td>
          <p>
            <a href="http://sourceforge.net/projects/dbcpp/forums/forum/920163" target="_top">http://sourceforge.net/projects/dbcpp/forums/forum/920163</a>
          </p>
          </td>
</tr>
<tr>
<td>
          <p>
            Comments
          </p>
          </td>
<td>
          <p>
            <a href="http://sourceforge.net/projects/dbcpp/forums/forum/920162" target="_top">http://sourceforge.net/projects/dbcpp/forums/forum/920162</a>
          </p>
          </td>
</tr>
<tr>
<td>
          <p>
            Contact the author
          </p>
          </td>
<td>
          <p>
            Email <a href="mailto:lorcaminiti@gmail.com" target="_top">lorcaminiti@gmail.com</a>
            (with [contract] in the subject)
          </p>
          </td>
</tr>
</tbody>
</table></div>
<p>
  </p>
<div class="section" lang="en">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="contract__.introduction"></a><a class="link" href="index.html#contract__.introduction" title="Introduction">Introduction</a>
</h2></div></div></div>
<p>
      Contract Programming (CP) is also known as <a href="http://en.wikipedia.org/wiki/Design_by_contract" target="_top">Design
      by Contract</a>
      <sup>[<a name="id2554159" href="#ftn.id2554159" class="footnote">1</a>]</sup>
      (DbC) and it was first introduced by the Eiffel programming language (see
      <a class="link" href="contract__/bibliography.html" title="Bibliography">[Meyer1997]</a>). All Contract Programming
      features of the Eiffel programming language are supported by this library,
      among others (see <a class="link" href="contract__/contract_programming.html#contract__.contract_programming.features" title="Features">Features</a>):
    </p>
<div class="itemizedlist"><ul type="disc">
<li>
        Optional compilation and checking of invariants, preconditions, and postconditions.
      </li>
<li>
        Customizable actions on contract failure (terminate by default but it can
        throw, exit, etc).
      </li>
<li>
        Subcontracting for derived classes (with support for pure virtual functions
        and multiple inheritance).
      </li>
<li>
        Access to "old" variable values (before body execution) and return
        value "result" in postconditions.
      </li>
<li>
        Support block invariants and loop variants.
      </li>
</ul></div>
<p>
      In brief, Contract Programming allows to specify invariants, preconditions,
      and postconditions that are automatically checked when functions are called
      at run-time. These conditions are used to assert the function specifications
      within the source code itself allowing to find bugs more quickly during testing
      and improving software quality.
    </p>
<a name="contract__.introduction.an_example"></a><h6>
<a name="id2554242"></a>
      <a class="link" href="index.html#contract__.introduction.an_example">An Example</a>
    </h6>
<p>
      This example shows how to write a contract for the C++ STL vector <code class="computeroutput"><span class="identifier">push_back</span><span class="special">()</span></code>
      function using this library. It also shows how to subcontract assuming that
      the vector class inherits from some <code class="computeroutput"><span class="identifier">pushable</span></code>
      base class.
    </p>
<p>
      </p>
<p>
        
</p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="string">"pushable.hpp"</span> <span class="comment">// Some base class (for subcontracting).
</span><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">contract</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span> <span class="comment">// This library.
</span><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">vector</span><span class="special">&gt;</span>       <span class="comment">// C++ STL vector.
</span>
<span class="comment">// Wrapper class that adds contracts to std::vector.
</span><span class="keyword">template</span><span class="special">&lt;</span><span class="keyword">typename</span> <span class="identifier">T</span><span class="special">&gt;</span>
<span class="keyword">class</span> <span class="identifier">myvector</span><span class="special">:</span> <span class="keyword">public</span> <span class="identifier">pushable</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span> <span class="special">{</span>

    <span class="bold"><strong>CONTRACT_INVARIANT</strong></span><span class="special">(</span> <span class="special">({</span>
        <span class="identifier">CONTRACT_ASSERT</span><span class="special">(</span> <span class="special">((</span><span class="identifier">size</span><span class="special">()</span> <span class="special">==</span> <span class="number">0</span><span class="special">)</span> <span class="special">==</span> <span class="identifier">empty</span><span class="special">()</span> <span class="special">);</span>
        <span class="special">...</span> <span class="comment">// More invariants.
</span>    <span class="special">})</span> <span class="special">)</span> <span class="callout_bug"><a class="co" name="contractpp0co" href="index.html#contractpp0"><img src="./doc/src/images/callouts/1.png" alt="1" border="0"></a></span>
    
<span class="keyword">public</span><span class="special">:</span>
    <span class="keyword">void</span> <span class="identifier">push_back</span><span class="special">(</span><span class="keyword">const</span> <span class="identifier">T</span><span class="special">&amp;</span> <span class="identifier">element</span><span class="special">)</span>
    <span class="bold"><strong>CONTRACT_FUNCTION</strong></span><span class="special">(</span> <span class="special">(</span><span class="keyword">class</span><span class="special">)</span> <span class="special">(</span><span class="identifier">copyable</span><span class="special">)(</span><span class="identifier">myvector</span><span class="special">)</span> <span class="callout_bug"><a class="co" name="contractpp1co" href="index.html#contractpp1"><img src="./doc/src/images/callouts/2.png" alt="2" border="0"></a></span> <span class="comment">// Function signature.
</span>            <span class="special">(</span><span class="identifier">inherit</span><span class="special">)(</span><span class="identifier">pushable</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;)</span> <span class="callout_bug"><a class="co" name="contractpp2co" href="index.html#contractpp2"><img src="./doc/src/images/callouts/3.png" alt="3" border="0"></a></span>
            <span class="special">(</span><span class="keyword">public</span><span class="special">)</span> <span class="special">(</span><span class="keyword">void</span><span class="special">)</span> <span class="special">(</span><span class="identifier">push_back</span><span class="special">)(</span> <span class="special">(</span><span class="keyword">const</span> <span class="identifier">T</span><span class="special">&amp;)(</span><span class="identifier">element</span><span class="special">)</span> <span class="special">)</span>
    <span class="special">(</span><span class="bold"><strong>precondition</strong></span><span class="special">)({</span> <span class="callout_bug"><a class="co" name="contractpp3co" href="index.html#contractpp3"><img src="./doc/src/images/callouts/4.png" alt="4" border="0"></a></span>
        <span class="identifier">CONTRACT_ASSERT</span><span class="special">(</span> <span class="identifier">size</span><span class="special">()</span> <span class="special">&lt;</span> <span class="identifier">max_size</span><span class="special">()</span> <span class="special">);</span>
        <span class="special">...</span> <span class="comment">// More preconditions.
</span>    <span class="special">})</span>
    <span class="special">(</span><span class="bold"><strong>postcondition</strong></span><span class="special">)({</span>
        <span class="identifier">CONTRACT_ASSERT</span><span class="special">(</span> <span class="identifier">size</span><span class="special">()</span> <span class="special">==</span> <span class="special">(</span><span class="identifier">CONTRACT_OLDOF</span><span class="special">(</span><span class="keyword">this</span><span class="special">)-&gt;</span><span class="identifier">size</span><span class="special">()</span> <span class="special">+</span> <span class="number">1</span><span class="special">)</span> <span class="special">);</span> <span class="callout_bug"><a class="co" name="contractpp4co" href="index.html#contractpp4"><img src="./doc/src/images/callouts/5.png" alt="5" border="0"></a></span>
        <span class="special">...</span> <span class="comment">// More postconditions.
</span>    <span class="special">})</span>
    <span class="special">(</span><span class="bold"><strong>body</strong></span><span class="special">)({</span> <span class="callout_bug"><a class="co" name="contractpp5co" href="index.html#contractpp5"><img src="./doc/src/images/callouts/6.png" alt="6" border="0"></a></span>
        <span class="identifier">vector_</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">(</span><span class="identifier">element</span><span class="special">);</span> <span class="comment">// Original implementation.
</span>    <span class="special">})</span> <span class="special">)</span> <span class="callout_bug"><a class="co" name="contractpp6co" href="index.html#contractpp6"><img src="./doc/src/images/callouts/7.png" alt="7" border="0"></a></span>
    
    <span class="special">...</span> <span class="comment">// Rest of the class.
</span><span class="keyword">private</span><span class="special">:</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;</span> <span class="identifier">vector_</span><span class="special">;</span>
<span class="special">};</span>

</pre>
<p>
      </p>
<p>
      </p>
<p>
        </p>
<div class="calloutlist"><table border="0" summary="Callout list">
<tr>
<td width="5%" valign="top" align="left"><p><a name="contractpp0"></a><a href="#contractpp0co"><img src="./doc/src/images/callouts/1.png" alt="1" border="0"></a> </p></td>
<td valign="top" align="left"><p> No need for "<code class="computeroutput"><span class="special">;</span></code>" after
        the macro closing parenthesis "<code class="computeroutput"><span class="special">)</span></code>".
        </p></td>
</tr>
<tr>
<td width="5%" valign="top" align="left"><p><a name="contractpp1"></a><a href="#contractpp1co"><img src="./doc/src/images/callouts/2.png" alt="2" border="0"></a> </p></td>
<td valign="top" align="left"><p> The function signature tokens are passed to the <a href="CONTRACT_FUNCTION.html" target="_top">CONTRACT_FUNCTION</a>()
        macro in the exact same order as they appear in the function declaration.
        The parenthesis <code class="computeroutput"><span class="special">()</span></code> around the
        tokens are mandatory (they create a <a href="http://www.boost.org/libs/preprocessor/doc/index.html" target="_top">Boost.Preprocessor</a>
        sequence). </p></td>
</tr>
<tr>
<td width="5%" valign="top" align="left"><p><a name="contractpp2"></a><a href="#contractpp2co"><img src="./doc/src/images/callouts/3.png" alt="3" border="0"></a> </p></td>
<td valign="top" align="left"><p> <code class="computeroutput"><span class="special">(</span><span class="identifier">inherit</span><span class="special">)(</span><span class="identifier">pushable</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;)</span></code>
        subcontracts from the base contract of <code class="computeroutput"><span class="identifier">pushable</span><span class="special">&lt;</span><span class="identifier">T</span><span class="special">&gt;::</span><span class="identifier">push_back</span><span class="special">()</span></code>.
        </p></td>
</tr>
<tr>
<td width="5%" valign="top" align="left"><p><a name="contractpp3"></a><a href="#contractpp3co"><img src="./doc/src/images/callouts/4.png" alt="4" border="0"></a> </p></td>
<td valign="top" align="left"><p> The precondition section <code class="computeroutput"><span class="special">(</span><span class="identifier">precondition</span><span class="special">)</span> <span class="special">({...})</span></code>
        and the postcondition section <code class="computeroutput"><span class="special">(</span><span class="identifier">postcondition</span><span class="special">)</span>
        <span class="special">({...})</span></code> can both be omitted, the body
        section <code class="computeroutput"><span class="special">(</span><span class="identifier">body</span><span class="special">)</span> <span class="special">({...})</span></code>
        is mandatory instead. </p></td>
</tr>
<tr>
<td width="5%" valign="top" align="left"><p><a name="contractpp4"></a><a href="#contractpp4co"><img src="./doc/src/images/callouts/5.png" alt="5" border="0"></a> </p></td>
<td valign="top" align="left"><p> <code class="computeroutput"><span class="identifier">CONTRACT_OLDOF</span><span class="special">(</span><span class="keyword">this</span><span class="special">)</span></code>
        is a copy to the object before the body is executed. For it to be available
        in postconditions, the class type had to be tagged copyable using <code class="computeroutput"><span class="special">(</span><span class="identifier">copyable</span><span class="special">)(</span><span class="identifier">myvector</span><span class="special">)</span></code> in the function signature sequence. </p></td>
</tr>
<tr>
<td width="5%" valign="top" align="left"><p><a name="contractpp5"></a><a href="#contractpp5co"><img src="./doc/src/images/callouts/6.png" alt="6" border="0"></a> </p></td>
<td valign="top" align="left"><p> The
        body specifies the original function definition. Instead of <code class="computeroutput"><span class="special">{</span> <span class="identifier">vector_</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">(</span><span class="identifier">element</span><span class="special">);</span> <span class="special">}</span></code>, <code class="computeroutput"><span class="string">";"</span></code> can be used to separate the function
        definition from its declaration, or <code class="computeroutput"><span class="string">" =
        0;"</span></code> can be used to write contracts for pure virtual
        functions. </p></td>
</tr>
<tr>
<td width="5%" valign="top" align="left"><p><a name="contractpp6"></a><a href="#contractpp6co"><img src="./doc/src/images/callouts/7.png" alt="7" border="0"></a> </p></td>
<td valign="top" align="left"><p> Again, no need for "<code class="computeroutput"><span class="special">;</span></code>"
        after macro closing parenthesis "<code class="computeroutput"><span class="special">)</span></code>".
        </p></td>
</tr>
</table></div>
<p>
      </p>
<p>
    </p>
<p>
      When the <code class="computeroutput"><span class="identifier">push_back</span><span class="special">()</span></code>
      function is called:
    </p>
<div class="orderedlist"><ol type="1">
<li>
        First, the class invariants and the function preconditions are checked.
      </li>
<li>
        Then, the function body is executed.
      </li>
<li>
        Lastly, the class invariants and function postconditions are checked.
      </li>
</ol></div>
<p>
      For example, if there is a bug in the function caller for which <code class="computeroutput"><span class="identifier">push_back</span><span class="special">()</span></code>
      is called when <code class="computeroutput"><span class="identifier">myvector</span></code> size
      is equal to <code class="computeroutput"><span class="identifier">max_size</span><span class="special">()</span></code>
      then the execution will be interrupted reporting a failure of the first assertion
      in the preconditions and it will be evident that the bug is in the caller:
    </p>
<pre class="programlisting">precondition: terminate called after throwing an instance of 'contract::failure'
  what():  contract "size() &lt; max_size()" failed at myvector.cpp:20
Aborted
</pre>
<p>
      Instead, if there is a bug in the <code class="computeroutput"><span class="identifier">push_back</span><span class="special">()</span></code> implementation for which <code class="computeroutput"><span class="identifier">myvector</span></code>
      size is not increased by 1 after <code class="computeroutput"><span class="identifier">element</span></code>
      has been added to the vector by the function body then the execution will be
      interrupted reporting a failure of the first assertion in the postconditions
      and it will be evident that the bug is in the <code class="computeroutput"><span class="identifier">push_back</span><span class="special">()</span></code> function implementation:
    </p>
<pre class="programlisting">postcondition: terminate called after throwing an instance of 'contract::failure'
  what():  contract "size() == (CONTRACT_OLDOF(this)-&gt;size() + 1)" failed at myvector.cpp:20
Aborted
</pre>
<p>
      Note how the library error messages contain enough information to uniquely
      identify the failure point: contract type (precondition, postcondition, etc),
      assertion text, file name, and line number.
    </p>
<a name="contract__.introduction.compilers_and_platforms"></a><h6>
<a name="id2604182"></a>
      <a class="link" href="index.html#contract__.introduction.compilers_and_platforms">Compilers and
      Platforms</a>
    </h6>
<p>
      This library is implemented using both preprocessor (<a href="http://www.boost.org/libs/preprocessor/doc/index.html" target="_top">Boost.Preprocessor</a>)
      and template (<a href="http://www.boost.org/libs/mpl/doc/index.html" target="_top">Boost.MPL</a>)
      metaprogramming. The library also uses templates with partial specializations
      and function pointer types (to implement an interface similar to the one of
      <a href="http://www.boost.org/doc/libs/1_42_0/doc/html/function.html" target="_top">Boost.Function</a>).
      As a consequence, this library is fairly demanding on compilers compliance
      with the ISO C++ standard. At present, this library has been successfully compiled
      and tested on the following compilers and platforms:
    </p>
<div class="orderedlist"><ol type="1">
<li>
        GCC 4.2.4 on Ubuntu Linux.
      </li>
<li>
        Microsoft Visual C++ 8.0 (MSVC 14) on Windows XP.
      </li>
<li>
        GCC 3.4.4 on Cygwin.
      </li>
</ol></div>
<p>
      (No other compiler was tried thus far.)
    </p>
</div>
<p>
  </p>
<p>
  </p>
<p>
  </p>
<p>
  </p>
<p>
  </p>
<p>
  </p>
<p>
  </p>
<p>
  </p>
<p>
  </p>
<p>
  </p>
<div class="footnotes">
<br><hr width="100" align="left">
<div class="footnote"><p><sup>[<a name="ftn.id2554159" href="#id2554159" class="para">1</a>] </sup>
          <span class="emphasis"><em>Design by Contract</em></span> is a registered trademark of <a href="http://en.wikipedia.org/wiki/Eiffel_Software" target="_top">Eiffel Software</a>.
        </p></div>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"><p><small>Last revised: February 21, 2010 at 23:08:31 GMT</small></p></td>
<td align="right"><div class="copyright-footer"></div></td>
</tr></table>
<hr>
<div class="spirit-nav"><a accesskey="n" href="contract__/getting_started.html"><img src="./doc/html/images/next.png" alt="Next"></a></div>
</body>
</html>
