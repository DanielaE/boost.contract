<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>dbc/post.hpp File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>dbc/post.hpp File Reference</h1>Header file to only include facilities to support "old" postfix in postconditions. <a href="#_details">More...</a>
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Namespaces</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">namespace &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacedbc.html">dbc</a></td></tr>

<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdbc_1_1copyable.html">dbc::copyable&lt; T &gt;</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Indicate the specified type is <a class="el" href="classdbc_1_1copyable.html" title="Indicate the specified type is copyable to support the &quot;old&quot; postfix in...">copyable</a> to support the "old" postfix in postconditions.  <a href="classdbc_1_1copyable.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdbc_1_1post.html">dbc::post&lt; T &gt;</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Postcondition argument types to support the "old" postfix.  <a href="classdbc_1_1post.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdbc_1_1post_3_01T_01_5_01_4.html">dbc::dbc::post&lt; T * &gt;</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Postcondition argument pointer types to support the "old" postfix.  <a href="classdbc_1_1post_3_01T_01_5_01_4.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdbc_1_1post_3_01copyable_3_01T_01_4_01_4.html">dbc::dbc::post&lt; copyable&lt; T &gt; &gt;</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Postcondition argument types to support the "old" postfix.  <a href="classdbc_1_1post_3_01copyable_3_01T_01_4_01_4.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdbc_1_1post_3_01copyable_3_01T_01_5_01_4_01_4.html">dbc::dbc::post&lt; copyable&lt; T * &gt; &gt;</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Postcondition argument pointer types to support the "old" postfix.  <a href="classdbc_1_1post_3_01copyable_3_01T_01_5_01_4_01_4.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="post_8hpp.html#b10fbb20732d114633c59fa07be8222a">DBC_COPYABLE</a>(type)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This macro marks the specified type copyable so its value before the body execution is available in postconditions via the <code></code>.old postfix.  <a href="#b10fbb20732d114633c59fa07be8222a"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Header file to only include facilities to support "old" postfix in postconditions. 
<p>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="b10fbb20732d114633c59fa07be8222a"></a><!-- doxytag: member="post.hpp::DBC_COPYABLE" ref="b10fbb20732d114633c59fa07be8222a" args="(type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DBC_COPYABLE          </td>
          <td>(</td>
          <td class="paramtype">type&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This macro marks the specified type copyable so its value before the body execution is available in postconditions via the <code></code>.old postfix. 
<p>
This macro should only be used with the <em>signature</em> argument of the <code><a class="el" href="mfun_8hpp.html#11cd5419adfe39cba4983b81dca63a71" title="This macro must follow the constructor declaration matching the specified signature...">DBC_CONSTRUCTOR()</a></code>, <code><a class="el" href="mfun_8hpp.html#a8a977641739ad90988dccb3bac04a13" title="This macro must follow the destructor declaration matching the specified signature...">DBC_DESTRUCTOR()</a></code>, and <code><a class="el" href="mfun_8hpp.html#2872f212b72c32e6254e34086e9714bf" title="This macro must follow the member function declaration matching the specified signature...">DBC_MEM_FUN()</a></code> contract macro API. When the contract code API <code>fun::constr</code>, <code>fun::destr</code>, and <code>fun::mem</code> are used, <code><a class="el" href="classdbc_1_1copyable.html" title="Indicate the specified type is copyable to support the &quot;old&quot; postfix in...">dbc::copyable</a></code> is used instead of this macro.<p>
For example (from <a class="el" href="Quick_Start.html#A_Complete_Example">A Complete Example</a>): <div class="fragment"><pre class="fragment"><span class="preprocessor">  #include &lt;<a class="code" href="dbc_8hpp.html" title="Header file to include the entire Design By Contract for C++ library.">dbc.hpp</a>&gt;</span>
  
  <span class="keyword">class </span>str <a class="code" href="object_8hpp.html#126883cfec96cafb25d481c5b1e6df61" title="This macro must follow the class type name and it privately derives the class from...">DBC_INHERIT_OBJECT</a>(str) {
  <span class="keyword">public</span>:
      <span class="comment">// Must have copy constructor.</span>
  
      <span class="keywordtype">char</span>&amp; operator[](<span class="keyword">const</span> <span class="keywordtype">size_t</span>&amp; index)
      <a class="code" href="mfun_8hpp.html#2872f212b72c32e6254e34086e9714bf" title="This macro must follow the member function declaration matching the specified signature...">DBC_MEM_FUN</a>( (<span class="keyword">public</span>) (<span class="keywordtype">char</span>&amp;) <a class="code" href="post_8hpp.html#b10fbb20732d114633c59fa07be8222a" title="This macro marks the specified type copyable so its value before the body execution...">DBC_COPYABLE</a>(str) <span class="comment">// Copyable class type.</span>
              (operator_at)( (<span class="keyword">const</span> <span class="keywordtype">size_t</span>&amp;)(index) ), {
          <a class="code" href="assertion_8hpp.html#393d8bc235939371624484cdda853395" title="Assert the specified condition, intended to be used to assert preconditions, postconditions...">DBC_ASSERT</a>(index &gt;= 0 &amp;&amp; index &lt; <span class="keyword">self</span>.size(), <span class="stringliteral">"index in range"</span>);
      }, {
          <span class="comment">// Not a const mem fun, use 'self.old' for object before body.</span>
          <a class="code" href="assertion_8hpp.html#393d8bc235939371624484cdda853395" title="Assert the specified condition, intended to be used to assert preconditions, postconditions...">DBC_ASSERT</a>(result == <span class="keyword">self</span>.old.chars_[index.now],
                  <span class="stringliteral">"returning char at index"</span>);
      }, {
          <span class="keywordflow">return</span> chars_[index];
      })
  
  <span class="keyword">private</span>:
      <span class="keywordtype">char</span>* chars_;
  };
</pre></div><p>
<dl class="warning" compact><dt><b>Warning:</b></dt><dd>A type should be declared copyable only and only if the value of the related variable before the body execution is <b>strictly needed</b> to assert postconditions. This is because of the followings:<ol type=1>
<li>A copyable type <em>must</em> have a copy constructor otherwise the code will not compile. If you are writing a template and declare one of the template parameters copyable, be aware that you are adding the extra requirement that the template parameter must have a copy constructor (and you might be doing so just to specify the contract while your template implementation would not require the copy constructor for that type).</li><li>This library internally uses the type's copy constructor to copy the type's value before the body is executed. This obviously has an impact on performance.</li><li>The copied value provided by the library via the <code>.old</code> in postconditions is only as good as the copy performed by the user defined copy constructor for the type. For example, if the copy constructor has a bug or it performs a shallow copy where a deep copy is semantically needed, the value returned by <code>.old</code> might violate one or more assertions in the postconditions not because of an issue in the function body but because of a problem in the copy constructor.</li></ol>
</dd></dl>
For example, there is no need to declare copyable the type of a constant argument (the argument cannot be modified by the body because it is declared constant). Similarly, there is no need to declare copyable the class type for a constant member function (the object cannot be modified by the body because the function is declared constant). <div class="fragment"><pre class="fragment">      <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
      <span class="keyword">class </span>C {
      <span class="keyword">public</span>:
          <span class="comment">// No need to declare C or "const T&amp;" copyable as const fun and arg.</span>
          T f(<span class="keyword">const</span> T&amp; x) <span class="keyword">const</span>
          <a class="code" href="mfun_8hpp.html#2872f212b72c32e6254e34086e9714bf" title="This macro must follow the member function declaration matching the specified signature...">DBC_MEM_FUN</a>( (<span class="keyword">public</span>) (T) (<span class="keyword">template</span>)(C) (f)( (<span class="keyword">const</span> T&amp;)(x) ) 
                  (<span class="keyword">const</span>), {
              ... <span class="comment">// Preconditions.</span>
          }, {
              <span class="comment">// self.old is same as self.now because this is a const member</span>
              <span class="comment">// function. Then use self.now and don't declare C copyable.</span>
              <span class="comment">// x.old is same as x.now because the argument is a const&amp;.</span>
              <span class="comment">// Then use self.now and don't declare "const T&amp;" copyable.</span>
              ... <span class="comment">// Postconditions.</span>
          }, {
              ... <span class="comment">// Body.</span>
          })
          
          <span class="comment">// Declaring the types copyable as done below is not needed, has a </span>
          <span class="comment">// performance impact, and requires C and T to have copy</span>
          <span class="comment">// constructors.</span>
          <span class="comment">//  T f(const T&amp; x) const</span>
          <span class="comment">//  DBC_MEM_FUN( (public) (T) (template)DBC_COPYABLE(C)</span>
          <span class="comment">//          (f)( DBC_COPYABLE(const T&amp;)(x) ) (const), ...)</span>
      };
</pre></div> <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>type</em>&nbsp;</td><td>The type that must be specified copyable. This type must have a copy costructor, otherwise the library will generate compile-time errors. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Mark the specified type copyable within the <em>signature</em> argument of contract macro API <code><a class="el" href="mfun_8hpp.html#11cd5419adfe39cba4983b81dca63a71" title="This macro must follow the constructor declaration matching the specified signature...">DBC_CONSTRUCTOR()</a></code>, <code><a class="el" href="mfun_8hpp.html#a8a977641739ad90988dccb3bac04a13" title="This macro must follow the destructor declaration matching the specified signature...">DBC_DESTRUCTOR()</a></code>, and <code><a class="el" href="mfun_8hpp.html#2872f212b72c32e6254e34086e9714bf" title="This macro must follow the member function declaration matching the specified signature...">DBC_MEM_FUN()</a></code>. </dd></dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><code><a class="el" href="classdbc_1_1copyable.html" title="Indicate the specified type is copyable to support the &quot;old&quot; postfix in...">dbc::copyable</a></code> for same functionality for contract code API. </dd></dl>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Jun 17 15:39:36 2009 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
