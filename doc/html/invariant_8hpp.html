<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>dbc/invariant.hpp File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>dbc/invariant.hpp File Reference</h1>Header file to only include facilities to write class invariants. <a href="#_details">More...</a>
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="invariant_8hpp.html#2fd19290c885c7d229480c3c58e40ac3">DBC_INVARIANT_FUN</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This symbol expands to the name of the class invariant function.  <a href="#2fd19290c885c7d229480c3c58e40ac3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="invariant_8hpp.html#fd939e7c1754a61a57c20bb7c6422ed4">DBC_INVARIANT</a>(full_class_type, invariants)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This macro must be used within the class declaration and it specifies the invariants for the given class.  <a href="#fd939e7c1754a61a57c20bb7c6422ed4"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Header file to only include facilities to write class invariants. 
<p>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="fd939e7c1754a61a57c20bb7c6422ed4"></a><!-- doxytag: member="invariant.hpp::DBC_INVARIANT" ref="fd939e7c1754a61a57c20bb7c6422ed4" args="(full_class_type, invariants)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DBC_INVARIANT          </td>
          <td>(</td>
          <td class="paramtype">full_class_type,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">invariants&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This macro must be used within the class declaration and it specifies the invariants for the given class. 
<p>
As a result of the code generated by this macro expansion, the specified class invariants are checked by calls to the class constructors, destructor, and member functions (if they have a contract) following the DBC <a class="el" href="Quick_Start.html#Constructor_Call_Semantics">call semantics</a>. The invariants specified by this macro are automatically documented (see <a class="el" href="Writing_Contracts.html#Automatic_Contract_Documentation">Automatic Contract Documentation</a>).<p>
<dl class="remark" compact><dt><b>Remarks:</b></dt><dd>It is recommended to use this macro at the very end of the class declaration and within a session with private access level. This is to make it clear that the code generated by this macro is not part of the public API of the class.</dd></dl>
For example (from <a class="el" href="Quick_Start.html#A_Complete_Example">A Complete Example</a>): <div class="fragment"><pre class="fragment"><span class="preprocessor">  #include &lt;<a class="code" href="dbc_8hpp.html" title="Header file to include the entire Design By Contract for C++ library.">dbc.hpp</a>&gt;</span>
  
  <span class="keyword">class </span>str <a class="code" href="object_8hpp.html#126883cfec96cafb25d481c5b1e6df61" title="This macro must follow the class type name and it privately derives the class from...">DBC_INHERIT_OBJECT</a>(str) {
  <span class="keyword">public</span>:
      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> MAX_SIZE = 16000;
      ...
  <span class="keyword">private</span>:
      <span class="keywordtype">size_t</span> size_;
      <span class="keywordtype">char</span>* chars_;
      ...
      
      <a class="code" href="invariant_8hpp.html#fd939e7c1754a61a57c20bb7c6422ed4" title="This macro must be used within the class declaration and it specifies the invariants...">DBC_INVARIANT</a>(str, {  <span class="comment">// At the very end and in a private section.</span>
          <span class="comment">// Invariants.</span>
          <a class="code" href="assertion_8hpp.html#393d8bc235939371624484cdda853395" title="Assert the specified condition, intended to be used to assert preconditions, postconditions...">DBC_ASSERT</a>(<span class="keyword">self</span>.chars_ != 0, <span class="stringliteral">"chars exist"</span>);
          <a class="code" href="assertion_8hpp.html#393d8bc235939371624484cdda853395" title="Assert the specified condition, intended to be used to assert preconditions, postconditions...">DBC_ASSERT</a>(<span class="keyword">self</span>.size_ &gt;= 0 &amp;&amp; <span class="keyword">self</span>.size_ &lt; str::MAX_SIZE,
                  <span class="stringliteral">"size in range"</span>);
          <span class="comment">// Assertions above passed, chars_[size_] can be accessed.</span>
          <a class="code" href="assertion_8hpp.html#393d8bc235939371624484cdda853395" title="Assert the specified condition, intended to be used to assert preconditions, postconditions...">DBC_ASSERT</a>(<span class="keyword">self</span>.chars_[<span class="keyword">self</span>.size_] == <span class="charliteral">'\0'</span>, <span class="stringliteral">"null-terminated"</span>);
      })
  };
</pre></div> <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>full_class_type</em>&nbsp;</td><td>The fully qualified class type. This class is <em>fully qualified</em> as it must indicate the full namespace (if declared within a namespace) and all the template parameters (for template classes). Furthermore, the class type must inherit from <code><a class="el" href="classdbc_1_1object.html" title="Any class with a contract must privately inherit from this base object class.">dbc::object</a></code> (see <code><a class="el" href="object_8hpp.html#126883cfec96cafb25d481c5b1e6df61" title="This macro must follow the class type name and it privately derives the class from...">DBC_INHERIT_OBJECT()</a></code>). For example: <div class="fragment"><pre class="fragment">      <span class="keyword">namespace </span>n {
          
      <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
      <span class="keyword">class </span>C <a class="code" href="object_8hpp.html#126883cfec96cafb25d481c5b1e6df61" title="This macro must follow the class type name and it privately derives the class from...">DBC_INHERIT_OBJECT</a>(C&lt;T&gt;) { <span class="comment">// Must inherit from dbc::object.</span>
      ...
      <span class="keyword">private</span>:
          <span class="comment">// Both namespace 'n' and template parameter 'T' are specified.</span>
          <a class="code" href="invariant_8hpp.html#fd939e7c1754a61a57c20bb7c6422ed4" title="This macro must be used within the class declaration and it specifies the invariants...">DBC_INVARIANT</a>(n::C&lt;T&gt;, { <span class="comment">// Fully qualified class type.</span>
              ... <span class="comment">// Invariants here.</span>
          })
      };
          
      } <span class="comment">// namespace n</span>
</pre></div> (This is different from the <code>class_type</code> parameter used by other macros which does not require full qualification.) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>invariants</em>&nbsp;</td><td>A code block <code>{...}</code> listing the class invariants. The following variables are available in this code block: <ul>
<li><code>self</code> is a constant reference <code>const&amp;</code> to the object (of type <code>full_class_type</code>).</li>
</ul>
<code><a class="el" href="assertion_8hpp.html#393d8bc235939371624484cdda853395" title="Assert the specified condition, intended to be used to assert preconditions, postconditions...">DBC_ASSERT()</a></code> and <code><a class="el" href="assertion_8hpp.html#7f1678c1e2a86b6d044d8a90af6a81ff" title="Assert the specified condition allowing to indicate the action to take in case the...">DBC_ASSERT_STREAM()</a></code> can be used to assert conditions in this code block. General code is allowed in this code block but it is strongly recommended to limit it to a <em>simple</em> list of assertions (otherwise it is likely that the contract will have more bugs than the code it is checking). </td></tr>
  </table>
</dl>
<dl class="remark" compact><dt><b>Remarks:</b></dt><dd>Invariants should use public members as much as possible so the contracts will be implementation independent. However, invariants are also used to check the correctness of the implementation and sometimes they must access the private or protected members. </dd></dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>This macro expands to the class invariants. If the <code>DBC_CHECK_INVARIANT</code> symbol is not defined at compile-time, this macro trivially expands to nothing, and no invariant code is compiled and checked. </dd></dl>
<dl class="see" compact><dt><b>See also:</b></dt><dd><code><a class="el" href="mfun_8hpp.html#b13901d1e1878203675c38531c6acb43" title="This macro must follow the constructor declaration matching the specified signature...">DBC_CONSTRUCTOR()</a></code>, <code><a class="el" href="mfun_8hpp.html#a8a977641739ad90988dccb3bac04a13" title="This macro must follow the destructor declaration matching the specified signature...">DBC_DESTRUCTOR()</a></code>, and <code><a class="el" href="mfun_8hpp.html#2872f212b72c32e6254e34086e9714bf" title="This macro must follow the member function declaration matching the specified signature...">DBC_MEM_FUN()</a></code> to specify member contracts. <p>
Use <code><a class="el" href="mparam_8hpp.html#8ee8cdd53b9cc3060ecef82fc02a8a4a" title="This macro is used to pass macro parameters containing commas.">DBC_MPARAM()</a></code> if <em>full_class_type</em> is a template with more than one parameter. <p>
Use <code><a class="el" href="invariant_8hpp.html#2fd19290c885c7d229480c3c58e40ac3" title="This symbol expands to the name of the class invariant function.">DBC_INVARIANT_FUN</a></code> to directly write the invariant code bypassing this macro (not recommended). </dd></dl>

</div>
</div><p>
<a class="anchor" name="2fd19290c885c7d229480c3c58e40ac3"></a><!-- doxytag: member="invariant.hpp::DBC_INVARIANT_FUN" ref="2fd19290c885c7d229480c3c58e40ac3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DBC_INVARIANT_FUN          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This symbol expands to the name of the class invariant function. 
<p>
This can be used to manually write the invariant function code therefore avoiding to use <code><a class="el" href="invariant_8hpp.html#fd939e7c1754a61a57c20bb7c6422ed4" title="This macro must be used within the class declaration and it specifies the invariants...">DBC_INVARIANT()</a></code>. This library will internally call a function named <code>DBC_INVARIANT_FUN</code> with a single argument of the correct class type (the object) to check the class invariant.<p>
<dl class="warning" compact><dt><b>Warning:</b></dt><dd>Explaining <code>DBC_INVARIANT_FUN</code> might be useful to better understand how the library internally works, but it is <b>strongly recommended to use </b> <code><a class="el" href="invariant_8hpp.html#fd939e7c1754a61a57c20bb7c6422ed4" title="This macro must be used within the class declaration and it specifies the invariants...">DBC_INVARIANT()</a></code> instead of <code>DBC_INVARIANT_FUN</code> because:<ol type=1>
<li><code>DBC_INVARIANT_FUN</code> reduces code readability.</li><li><code>DBC_INVARIANT_FUN</code> requires the programmer to write more code to handle the <code>#ifdef DBC_...</code> compilation guard increasing the possibility of errors.</li><li>Only <code><a class="el" href="invariant_8hpp.html#fd939e7c1754a61a57c20bb7c6422ed4" title="This macro must be used within the class declaration and it specifies the invariants...">DBC_INVARIANT()</a></code> automatically documents the invariants.</li><li>Only <code><a class="el" href="invariant_8hpp.html#fd939e7c1754a61a57c20bb7c6422ed4" title="This macro must be used within the class declaration and it specifies the invariants...">DBC_INVARIANT()</a></code> checks at compile time for incorrect use of the library (e.g., makes sure that the specified class type inherits from <code><a class="el" href="classdbc_1_1object.html" title="Any class with a contract must privately inherit from this base object class.">dbc::object</a></code>).</li></ol>
</dd></dl>
The <code><a class="el" href="invariant_8hpp.html#fd939e7c1754a61a57c20bb7c6422ed4" title="This macro must be used within the class declaration and it specifies the invariants...">DBC_INVARIANT()</a></code> macro expands to an inline friend void function named by <code>DBC_INVARIANT_FUN</code> with the specified invariants code block as its definition and taking a constant reference to the object as single argument. For example: <div class="fragment"><pre class="fragment"><span class="preprocessor">  #include &lt;<a class="code" href="dbc_8hpp.html" title="Header file to include the entire Design By Contract for C++ library.">dbc.hpp</a>&gt;</span>
  
  <span class="keyword">class </span>C <a class="code" href="object_8hpp.html#126883cfec96cafb25d481c5b1e6df61" title="This macro must follow the class type name and it privately derives the class from...">DBC_INHERIT_OBJECT</a>(C) { <span class="comment">// Recommended form.</span>
      ...
  <span class="keyword">private</span>:
      <a class="code" href="invariant_8hpp.html#fd939e7c1754a61a57c20bb7c6422ed4" title="This macro must be used within the class declaration and it specifies the invariants...">DBC_INVARIANT</a>(C, {
          ... <span class="comment">// Assert C's invariants here.</span>
      })
  };
</pre></div> is essentially equivalent to: <div class="fragment"><pre class="fragment"><span class="preprocessor">  #include &lt;<a class="code" href="dbc_8hpp.html" title="Header file to include the entire Design By Contract for C++ library.">dbc.hpp</a>&gt;</span>
  
  <span class="keyword">class </span>C <a class="code" href="object_8hpp.html#126883cfec96cafb25d481c5b1e6df61" title="This macro must follow the class type name and it privately derives the class from...">DBC_INHERIT_OBJECT</a>(C) { <span class="comment">// Equivalent code form (not recommended).</span>
      ...
  <span class="keyword">private</span>:
<span class="preprocessor">  #ifdef DBC_CHECK_INVARIANT</span>
<span class="preprocessor"></span>      <span class="keyword">friend</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="invariant_8hpp.html#2fd19290c885c7d229480c3c58e40ac3" title="This symbol expands to the name of the class invariant function.">DBC_INVARIANT_FUN</a>(<span class="keyword">const</span> C&amp; <span class="keyword">self</span>) {
          ... <span class="comment">// Assert C's invariants here.</span>
      }
<span class="preprocessor">  #endif // DBC_CHECK_INVARIANT</span>
<span class="preprocessor">  };</span>
</pre></div> (The correct function is selected via function overloading resolution based on the class type function argument.) <dl class="return" compact><dt><b>Returns:</b></dt><dd>If the <code>DBC_CHECK_INVARIANT</code> symbol is not defined at compile-time, this macro expands to nothing. Otherwise, it expands to the name of the function internally invoked by the library to check class invariants. (The actual name of the invariant function is implementation specific it should be referred to via this macro.) </dd></dl>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Nov 21 11:16:02 2009 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
